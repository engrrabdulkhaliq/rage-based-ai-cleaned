<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sigma Web Dev AI Assistant</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <style>
        *{margin:0;padding:0;box-sizing:border-box}
        body{
            font-family:'Inter',sans-serif;
            background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);
            min-height:100vh;overflow:hidden
        }
        .particles{position:fixed;inset:0;pointer-events:none;z-index:0}
        .main-container{position:relative;z-index:1;height:100vh;display:flex;align-items:center;justify-content:center;padding:20px}
        .chat-wrapper{
            width:100%;max-width:1200px;height:90vh;
            background:rgba(255,255,255,.95);
            backdrop-filter:blur(20px);
            border-radius:24px;
            box-shadow:0 20px 60px rgba(0,0,0,.3);
            display:flex;flex-direction:column;overflow:hidden
        }
        .chat-header{
            background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);
            padding:25px 30px;color:#fff;
            display:flex;align-items:center;gap:15px
        }
        .logo-icon{
            width:50px;height:50px;background:#fff;border-radius:12px;
            display:flex;align-items:center;justify-content:center;
            font-size:24px;color:#667eea
        }
        .chat-messages{flex:1;overflow-y:auto;padding:30px;background:#f8f9fa}
        .message{display:flex;gap:15px;margin-bottom:20px}
        .message.user{flex-direction:row-reverse}
        .message-avatar{
            width:45px;height:45px;border-radius:50%;
            display:flex;align-items:center;justify-content:center;
            font-size:18px;color:#fff
        }
        .message.user .message-avatar{background:#667eea}
        .message.assistant .message-avatar{background:#f5576c}
        .message-content{
            max-width:70%;padding:16px 20px;border-radius:18px;
            font-size:15px;line-height:1.6
        }
        .message.user .message-content{
            background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);
            color:#fff
        }
        .message.assistant .message-content{
            background:#fff;color:#2d3748;border:1px solid #e2e8f0
        }
        .chat-input-container{
            padding:25px 30px;background:#fff;border-top:1px solid #e2e8f0
        }
        .chat-input-wrapper{
            display:flex;gap:12px;align-items:center;
            background:#f8f9fa;border-radius:16px;padding:8px;
            border:2px solid #e2e8f0
        }
        .chat-input{flex:1;border:none;background:transparent;padding:12px;outline:none}
        .send-button{
            width:48px;height:48px;border:none;border-radius:12px;
            background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);
            color:#fff;cursor:pointer
        }
        .send-button:disabled{background:#cbd5e0;cursor:not-allowed}
        .error-message{
            background:#e53e3e;color:#fff;
            padding:14px;margin:10px;border-radius:10px;text-align:center
        }
    </style>
</head>

<body>
<canvas class="particles" id="particles"></canvas>

<div class="main-container">
    <div class="chat-wrapper">
        <div class="chat-header">
            <div class="logo-icon"><i class="fas fa-robot"></i></div>
            <div>
                <h4 class="mb-0">Sigma Web Dev AI Assistant</h4>
                <small>Your personal course guide</small>
            </div>
        </div>

        <div class="chat-messages" id="chatMessages"></div>
        <div id="errorContainer"></div>

        <div class="chat-input-container">
            <div class="chat-input-wrapper">
                <input id="userInput" class="chat-input" placeholder="Ask about web development…" />
                <button id="sendBtn" class="send-button">
                    <i class="fas fa-paper-plane"></i>
                </button>
            </div>
        </div>
    </div>
</div>

<script>
/* ================= FIXED API ================= */
const API_URL = "/chat";   // ✅ SAME DOMAIN (production safe)

let isLoading = false;

function addMessage(role, text){
    const box=document.getElementById("chatMessages");
    const msg=document.createElement("div");
    msg.className=`message ${role}`;
    msg.innerHTML=`
        <div class="message-avatar">
            <i class="fas ${role==='user'?'fa-user':'fa-robot'}"></i>
        </div>
        <div class="message-content">${text}</div>
    `;
    box.appendChild(msg);
    box.scrollTop=box.scrollHeight;
}

function showError(text){
    document.getElementById("errorContainer").innerHTML=
        `<div class="error-message">${text}</div>`;
}

async function sendMessage(){
    const input=document.getElementById("userInput");
    const msg=input.value.trim();
    if(!msg||isLoading) return;

    addMessage("user",msg);
    input.value="";
    isLoading=true;
    document.getElementById("sendBtn").disabled=true;

    try{
        const res=await fetch(API_URL,{
            method:"POST",
            headers:{"Content-Type":"application/json"},
            body:JSON.stringify({message:msg})
        });
        if(!res.ok) throw new Error();
        const data=await res.json();
        addMessage("assistant",data.reply);
    }catch{
        showError("Server not responding.");
    }finally{
        isLoading=false;
        document.getElementById("sendBtn").disabled=false;
    }
}

document.getElementById("sendBtn").onclick=sendMessage;
document.getElementById("userInput").addEventListener("keypress",e=>{
    if(e.key==="Enter"){e.preventDefault();sendMessage();}
});
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
